<Window x:Class="WPF_UI1.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:local="clr-namespace:WPF_UI1"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- 深色主题配色 -->
        <SolidColorBrush x:Key="DarkBackground" Color="#FF353535"/>
        <SolidColorBrush x:Key="DarkSurface" Color="#FF191919"/>
        <SolidColorBrush x:Key="DarkPrimary" Color="#FF2A82DA"/>
        <SolidColorBrush x:Key="LightText" Color="White"/>
        <SolidColorBrush x:Key="SecondaryText" Color="#FFB3B3B3"/>

        <!-- 状态颜色 -->
        <SolidColorBrush x:Key="SuccessColor" Color="#FF4CAF50"/>
        <SolidColorBrush x:Key="WarningColor" Color="#FFFF9800"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#FFF44336"/>

        <!-- 数据模板 -->
        <DataTemplate x:Key="GpuItemTemplate">
            <TextBlock Text="{Binding Name}" ToolTip="{Binding Brand}"/>
        </DataTemplate>

        <DataTemplate x:Key="NetworkAdapterTemplate">
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding StringFormat="{}{0} ({1})">
                        <Binding Path="Name"/>
                        <Binding Path="AdapterType"/>
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>

        <DataTemplate x:Key="DiskItemTemplate">
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding StringFormat="驱动器 {0}: ({1})">
                        <Binding Path="Letter"/>
                        <Binding Path="Label"/>
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>
    </Window.Resources>

    <Grid Background="{StaticResource DarkBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <materialDesign:Card Grid.Row="0" Margin="10,10,10,5" 
                            Background="{StaticResource DarkSurface}">
            <Grid Margin="15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Monitor" 
                                           Foreground="{StaticResource DarkPrimary}" 
                                           Width="24" Height="24" 
                                           VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding WindowTitle}" 
                              FontSize="18" FontWeight="Bold"
                              Foreground="{StaticResource LightText}"
                              Margin="10,0,0,0" 
                              VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Border Background="{Binding IsConnected, Converter={StaticResource BooleanToColorConverter}}"
                            CornerRadius="6" Padding="8,4">
                        <TextBlock Text="{Binding ConnectionStatus}" 
                                  Foreground="White" FontSize="12"/>
                    </Border>
                    <Button Content="重连" 
                           Command="{Binding ReconnectCommand}"
                           Style="{StaticResource MaterialDesignFlatButton}"
                           Margin="10,0,0,0"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- 主内容区域 -->
        <ScrollViewer Grid.Row="1" 
                     VerticalScrollBarVisibility="Auto" 
                     Padding="10,5,10,5">
            <StackPanel>

                <!-- CPU和内存信息行 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- CPU信息 -->
                    <materialDesign:Card Grid.Column="0" Margin="0,0,5,10" 
                                        Background="{StaticResource DarkSurface}">
                        <Expander Header="处理器信息" IsExpanded="True"
                                 Foreground="{StaticResource LightText}">
                            <Grid Margin="15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="名称:" Margin="0,5"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding CpuName}" Margin="10,5" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="物理核心:" Margin="0,5"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding PhysicalCores}" Margin="10,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="逻辑核心:" Margin="0,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding LogicalCores}" Margin="10,5"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="性能核心:" Margin="0,5"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding PerformanceCores}" Margin="10,5"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="能效核心:" Margin="0,5"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding EfficiencyCores}" Margin="10,5"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="CPU使用率:" Margin="0,5"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Margin="10,5">
                                    <TextBlock.Text>
                                        <Binding Path="CpuUsage" StringFormat="{}{0:F1}%"/>
                                    </TextBlock.Text>
                                </TextBlock>

                                <TextBlock Grid.Row="6" Grid.Column="0" Text="CPU基准频率:" Margin="0,5"/>
                                <TextBlock Grid.Row="6" Grid.Column="1" Margin="10,5">
                                    <TextBlock.Text>
                                        <Binding Path="CpuBaseFrequencyMHz" StringFormat="{}{0:F0} MHz"/>
                                    </TextBlock.Text>
                                </TextBlock>

                                <TextBlock Grid.Row="7" Grid.Column="0" Text="CPU即时频率:" Margin="0,5"/>
                                <TextBlock Grid.Row="7" Grid.Column="1" Margin="10,5">
                                    <TextBlock.Text>
                                        <Binding Path="CpuCurrentFrequencyMHz" StringFormat="{}{0:F0} MHz"/>
                                    </TextBlock.Text>
                                </TextBlock>

                                <TextBlock Grid.Row="8" Grid.Column="0" Text="超线程:" Margin="0,5"/>
                                <TextBlock Grid.Row="8" Grid.Column="1" Text="{Binding HyperThreading, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>

                                <TextBlock Grid.Row="9" Grid.Column="0" Text="虚拟化:" Margin="0,5"/>
                                <TextBlock Grid.Row="9" Grid.Column="1" Text="{Binding Virtualization, Converter={StaticResource BooleanToSupportConverter}}" Margin="10,5"/>

                                <TextBlock Grid.Row="10" Grid.Column="0" Text="CPU温度:" Margin="0,5"/>
                                <TextBlock Grid.Row="10" Grid.Column="1" Margin="10,5">
                                    <TextBlock.Text>
                                        <Binding Path="CpuTemperature" StringFormat="{}{0:F1}℃"/>
                                    </TextBlock.Text>
                                </TextBlock>

                                <TextBlock Grid.Row="11" Grid.Column="0" Text="采样间隔:" Margin="0,5"/>
                                <TextBlock Grid.Row="11" Grid.Column="1" Margin="10,5" Text="{Binding CpuUsageSampleIntervalMs, StringFormat={}{0:F0} ms}"/>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>

                    <!-- 内存信息 -->
                    <materialDesign:Card Grid.Column="1" Margin="5,0,0,10" 
                                        Background="{StaticResource DarkSurface}">
                        <Expander Header="内存信息" IsExpanded="True"
                                 Foreground="{StaticResource LightText}">
                            <Grid Margin="15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="总内存:" Margin="0,5"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding TotalMemory}" Margin="10,5" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="已用内存:" Margin="0,5"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding UsedMemory}" Margin="10,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="可用内存:" Margin="0,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding AvailableMemory}" Margin="10,5"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="内存使用率:" Margin="0,5"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Margin="10,5">
                                    <TextBlock.Text>
                                        <Binding Path="MemoryUsagePercent" StringFormat="{}{0:F1}%"/>
                                    </TextBlock.Text>
                                </TextBlock>

                                <!-- 内存使用率进度条 -->
                                <ProgressBar Grid.Row="4" Grid.ColumnSpan="2" 
                                           Value="{Binding MemoryUsagePercent}" 
                                           Maximum="100" Height="8" Margin="0,10,0,0"/>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>
                </Grid>

                <!-- GPU和网络信息行 -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- GPU信息 -->
                    <materialDesign:Card Grid.Column="0" Margin="0,0,5,10" 
                                        Background="{StaticResource DarkSurface}">
                        <Expander Header="显卡信息" IsExpanded="True"
                                 Foreground="{StaticResource LightText}">
                            <Grid Margin="15">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- GPU选择器 -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="GPU选择:" VerticalAlignment="Center" Margin="0,5"/>
                                    <ComboBox Grid.Column="1" 
                                             ItemsSource="{Binding Gpus}"
                                             SelectedItem="{Binding SelectedGpu}"
                                             ItemTemplate="{StaticResource GpuItemTemplate}"
                                             Margin="10,5"/>
                                </Grid>

                                <!-- GPU详细信息 -->
                                <Grid Grid.Row="1" DataContext="{Binding SelectedGpu}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="名称:" Margin="0,5"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Name}" Margin="10,5" FontWeight="Bold"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="品牌:" Margin="0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Brand}" Margin="10,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="显存:" Margin="0,5"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Memory, Converter={StaticResource BytesToStringConverter}}" Margin="10,5"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="核心频率:" Margin="0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Margin="10,5">
                                        <TextBlock.Text>
                                            <Binding Path="CoreClock" StringFormat="{}{0:F1} MHz"/>
                                        </TextBlock.Text>
                                    </TextBlock>

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="GPU温度:" Margin="0,5"/>
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding DataContext.GpuTemperature, RelativeSource={RelativeSource AncestorType=Window}, StringFormat={}{0:F1}℃}" Margin="10,5"/>
                                </Grid>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>

                    <!-- 网络信息 -->
                    <materialDesign:Card Grid.Column="1" Margin="5,0,0,10" 
                                        Background="{StaticResource DarkSurface}">
                        <Expander Header="网络信息" IsExpanded="True"
                                 Foreground="{StaticResource LightText}">
                            <Grid Margin="15">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- 网络适配器选择器 -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="网络适配器:" VerticalAlignment="Center" Margin="0,5"/>
                                    <ComboBox Grid.Column="1" 
                                             ItemsSource="{Binding NetworkAdapters}"
                                             SelectedItem="{Binding SelectedNetworkAdapter}"
                                             ItemTemplate="{StaticResource NetworkAdapterTemplate}"
                                             Margin="10,5"/>
                                </Grid>

                                <!-- 网络适配器详细信息 -->
                                <Grid Grid.Row="1" DataContext="{Binding SelectedNetworkAdapter}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="适配器名称:" Margin="0,5"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Name}" Margin="10,5" FontWeight="Bold"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="网卡类型:" Margin="0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding AdapterType}" Margin="10,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="IP地址:" Margin="0,5"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding IpAddress}" Margin="10,5"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="MAC地址:" Margin="0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Mac}" Margin="10,5"/>

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="连接速度:" Margin="0,5"/>
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Speed, Converter={StaticResource NetworkSpeedConverter}}" Margin="10,5"/>
                                </Grid>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>
                </Grid>

                <!-- 温度监控图表 -->
                <materialDesign:Card Margin="0,0,0,10" Background="{StaticResource DarkSurface}">
                    <Expander Header="温度监控" IsExpanded="True"
                             Foreground="{StaticResource LightText}">
                        <Grid Margin="15" Height="300">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- CPU温度图表 -->
                            <Grid Grid.Column="0" Margin="0,0,5,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="7*"/>
                                    <ColumnDefinition Width="6*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="CPU温度历史" 
                                          FontWeight="Bold" Margin="250,0,0,10"
                                          HorizontalAlignment="Left" Grid.ColumnSpan="2"/>
                                <lvc:CartesianChart Series="{Binding CpuTemperatureSeries}" Grid.ColumnSpan="2" Margin="0,24,0,0" Grid.RowSpan="2"/>
                            </Grid>

                            <!-- GPU温度图表 -->
                            <Grid Grid.Column="1" Margin="5,0,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="GPU温度历史" 
                                          FontWeight="Bold" Margin="0,0,0,10"
                                          HorizontalAlignment="Center"/>
                                <lvc:CartesianChart Grid.Row="1" Series="{Binding GpuTemperatureSeries}"/>
                            </Grid>
                        </Grid>
                    </Expander>
                </materialDesign:Card>

                <!-- 存储设备信息 -->
                <materialDesign:Card Margin="0,0,0,10" Background="{StaticResource DarkSurface}">
                    <Expander Header="存储设备信息" IsExpanded="True"
                             Foreground="{StaticResource LightText}">
                        <Grid Margin="15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 物理磁盘选择器 -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="物理磁盘:" VerticalAlignment="Center" Margin="0,5"/>
                                <ComboBox Grid.Column="1" ItemsSource="{Binding PhysicalDisks}" SelectedItem="{Binding SelectedPhysicalDisk}" DisplayMemberPath="DisplayName" Margin="10,5"/>
                                <Button Grid.Column="2" Content="SMART详情" Command="{Binding ShowSmartDetailsCommand}" Style="{StaticResource MaterialDesignFlatButton}" Margin="10,5,0,5"/>
                            </Grid>

                            <!-- 分区列表（改为 ListBox 双向绑定 SelectedDisk，避免事件和不同步问题） -->
                            <Border Grid.Row="1" Margin="0,10,0,0" BorderBrush="{StaticResource DarkPrimary}" BorderThickness="1" CornerRadius="4" Padding="8">
                                <StackPanel>
                                    <TextBlock Text="分区:" FontWeight="Bold"/>
                                    <ListBox ItemsSource="{Binding SelectedPhysicalDisk.Partitions}"
                                             SelectedItem="{Binding SelectedDisk, Mode=TwoWay}"
                                             BorderThickness="0"
                                             Background="Transparent">
                                        <ListBox.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ListBox.ItemsPanel>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Margin="2" Padding="6,2" CornerRadius="12" BorderBrush="{StaticResource DarkPrimary}" BorderThickness="1">
                                                    <TextBlock Text="{Binding Letter, StringFormat={}{0}:}"/>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </StackPanel>
                            </Border>

                            <!-- 选中分区详细信息 -->
                            <Grid Grid.Row="2" DataContext="{Binding SelectedDisk}" Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- 基本信息 -->
                                <GroupBox Grid.Column="0" Header="基本信息" Margin="0,0,5,0">
                                    <Grid Margin="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="盘符:" Margin="0,5"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Letter, StringFormat={}{0}:}" Margin="10,5" FontWeight="Bold"/>
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="卷标:" Margin="0,5"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Label}" Margin="10,5"/>
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="文件系统:" Margin="0,5"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding FileSystem}" Margin="10,5"/>
                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="总容量:" Margin="0,5"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding TotalSize, Converter={StaticResource BytesToStringConverter}}" Margin="10,5"/>
                                    </Grid>
                                </GroupBox>

                                <!-- 使用情况 -->
                                <GroupBox Grid.Column="1" Header="使用情况" Margin="5,0,0,0">
                                    <Grid Margin="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="已用空间:" Margin="0,5"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding UsedSpace, Converter={StaticResource BytesToStringConverter}}" Margin="10,5"/>
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="可用空间:" Margin="0,5"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FreeSpace, Converter={StaticResource BytesToStringConverter}}" Margin="10,5"/>
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="使用率:" Margin="0,5"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Margin="10,5">
                                            <TextBlock.Text>
                                                <MultiBinding Converter="{StaticResource DiskUsagePercentageConverter}">
                                                    <Binding Path="UsedSpace"/>
                                                    <Binding Path="TotalSize"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                        <ProgressBar Grid.Row="3" Grid.ColumnSpan="2" Height="8" Margin="0,10,0,0">
                                            <ProgressBar.Value>
                                                <MultiBinding Converter="{StaticResource DiskUsagePercentageConverter}">
                                                    <Binding Path="UsedSpace"/>
                                                    <Binding Path="TotalSize"/>
                                                </MultiBinding>
                                            </ProgressBar.Value>
                                        </ProgressBar>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </Grid>
                    </Expander>
                </materialDesign:Card>

                <!-- TPM 信息（独立卡片，扩展状态显示） -->
                <materialDesign:Card Margin="0,0,0,10" Background="{StaticResource DarkSurface}">
                    <Expander Header="TPM 信任平台模块" IsExpanded="False" Foreground="{StaticResource LightText}">
                        <Grid Margin="15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="检测结果:" Margin="0,5"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding HasTpm, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5" FontWeight="Bold"/>
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="制造商:" Margin="0,5"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding TpmManufacturer}" Margin="10,5"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="制造商ID:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding TpmManufacturerId}" Margin="10,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="版本:" Margin="0,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding TpmVersion}" Margin="10,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="2" Text="固件版本:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="3" Text="{Binding TpmFirmwareVersion}" Margin="10,5"/>
                            <TextBlock Grid.Row="3" Grid.Column="0" Text="状态:" Margin="0,5"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding TpmStatus}" Margin="10,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="0" Text="启用:" Margin="0,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding TpmEnabled, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="2" Text="激活:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="4" Grid.Column="3" Text="{Binding TpmIsActivated, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="5" Grid.Column="0" Text="已拥有:" Margin="0,5"/>
                            <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding TpmIsOwned, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="5" Grid.Column="2" Text="就绪:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="5" Grid.Column="3" Text="{Binding TpmReady, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="6" Grid.Column="0" Text="TBS可用:" Margin="0,5"/>
                            <TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding TpmTbsAvailable, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="6" Grid.Column="2" Text="需物理存在:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="6" Grid.Column="3" Text="{Binding TpmPhysicalPresenceRequired, Converter={StaticResource BooleanToYesNoConverter}}" Margin="10,5"/>
                            <TextBlock Grid.Row="7" Grid.Column="0" Text="规范版本:" Margin="0,5"/>
                            <TextBlock Grid.Row="7" Grid.Column="1" Text="{Binding TpmSpecVersion}" Margin="10,5"/>
                            <TextBlock Grid.Row="7" Grid.Column="2" Text="TBS版本:" Margin="30,5,0,5"/>
                            <TextBlock Grid.Row="7" Grid.Column="3" Text="{Binding TpmTbsVersion}" Margin="10,5"/>
                            <TextBlock Grid.Row="8" Grid.Column="0" Text="检测方法:" Margin="0,5"/>
                            <TextBlock Grid.Row="8" Grid.Column="1" Grid.ColumnSpan="3" Text="{Binding TpmDetectionMethod}" Margin="10,5" FontWeight="Bold"/>
                            <TextBlock Grid.Row="9" Grid.Column="0" Text="错误信息:" Margin="0,5"/>
                            <TextBlock Grid.Row="9" Grid.Column="1" Grid.ColumnSpan="3" TextWrapping="Wrap" Text="{Binding TpmErrorMessage}" Margin="10,5"/>
                            <StackPanel Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="4" Orientation="Horizontal" Margin="0,10,0,0">
                                <Border Background="{StaticResource SuccessColor}" Padding="6,2" Margin="0,0,10,0" CornerRadius="4" Visibility="{Binding TpmReady, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="TPM就绪" Foreground="White" FontSize="12"/>
                                </Border>
                                <Border Background="{StaticResource WarningColor}" Padding="6,2" Margin="0,0,10,0" CornerRadius="4" Visibility="{Binding TpmPhysicalPresenceRequired, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="需要物理交互" Foreground="White" FontSize="12"/>
                                </Border>
                                <Border Background="{StaticResource ErrorColor}" Padding="6,2" Margin="0,0,10,0" CornerRadius="4" Visibility="{Binding HasTpm, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                    <TextBlock Text="未检测到TPM" Foreground="White" FontSize="12"/>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Expander>
                </materialDesign:Card>

                <!-- 状态栏 -->
                <materialDesign:Card Grid.Row="2" Margin="10,5,10,10" 
                            Background="{StaticResource DarkSurface}">
                    <Grid Margin="15,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" 
                                  Text="{Binding ConnectionStatus}" 
                                  VerticalAlignment="Center"
                                  Foreground="{StaticResource SecondaryText}"/>

                        <TextBlock Grid.Column="1" 
                                  VerticalAlignment="Center"
                                  Foreground="{StaticResource SecondaryText}">
                            <TextBlock.Text>
                                <Binding Source="{x:Static sys:DateTime.Now}" StringFormat="最后更新: {0:HH:mm:ss}"/>
                            </TextBlock.Text>
                        </TextBlock>
                    </Grid>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
